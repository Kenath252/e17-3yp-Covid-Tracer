{% load static %}

<!DOCTYPE html>
<!-- Designined by CodingLab | www.youtube.com/codinglabyt -->
<html lang="en" dir="ltr">
  <head>
    <meta charset="UTF-8">
    <title>Covid Tracer</title>
    <link rel="stylesheet" href="{% static 'css/home_style.css' %}">
    <!-- Boxicons CDN Link -->
    <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
        integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
        integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
        crossorigin="anonymous"></script>


</head>
<style>
table {
  border-collapse: collapse;
  table-layout: auto;
  width : 100%;
  display:table;
  margin-right:auto;
  margin-left:auto;
}

th, td {
  text-align: center;
  padding: 8px;
}

tr:nth-child(even){background-color: #f2f2f2}

th {
  background-color: #4f8964;
  color: white;
}

input[type="radio"] {
  margin-left: 10px;
  font-size: 15px; /* Increase font-size */
  padding: 12px 20px 12px 40px; /* Add some padding */
  border: 1px solid #ddd; /* Add a grey border */
  margin-bottom: 12px; /* Add some space below the input */

}
#myInput {
  width: 100%; /* Full-width */
  font-size: 16px; /* Increase font-size */
  padding: 12px 20px 12px 40px; /* Add some padding */
  border: 1px solid #ddd; /* Add a grey border */
  margin-bottom: 12px; /* Add some space below the input */


}


#percentage{
  color:black;  
  padding: 5px 8px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  margin-right:36px;


}


.select{
  width: 170px;
  height: 28px;
  margin-right:30px;

}


#submit1{
  background-color: #4f8964;
  border: none;
  color: white;
  padding: 5px 12px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  margin: 4px 2px;
  cursor: pointer;

}


</style>


<body>

    <div class="sidebar">

        <div class="logo-details">
        <span class="logo_name" style="margin-left: 30px;">Covid Tracer</span>
        </div>

        <ul class="nav-links">
        <li>
            <a href="home">
            <i class='bx bx-grid-alt' ></i>
            <span class="links_name">Dashboard</span>
            </a>
        </li>

        <li>
            <a href="#" class="active">
            <i class='bx bx-map' ></i>
            <span class="links_name">Check a location</span>
            </a>
        </li>

        <li>
            <a href="trace">
            <i class='bx bx-map-pin' ></i>
            <span class="links_name">Trace my locations</span>
            </a>
        </li>

        <li>
            <a href="#">
            <i class='bx bx-bell' ></i>
            <span class="links_name">Notifications</span>
            </a>
        </li>

        <li>
            <a href="#">
            <i class='bx bx-message' ></i>
            <span class="links_name">Health News</span>
            </a>
        </li>

        <li>
            <a href="myaccount">
            <i class='bx bx-user' ></i>
            <span class="links_name">My Account</span>
            </a>
        </li>

        <li>
            <a href="#">
            <i class='bx bx-info-circle' ></i>
            <span class="links_name">About Covid Tracer</span>
            </a>
        </li>

        <li class="log_out">
            <a href="../website/bla">
            <i class='bx bx-log-out'></i>
            <span class="links_name">Log out</span>
            </a>
        </li>
        </ul>

    </div>
    <!--End of side bar-->


    <section class="home-section">
    
        <nav>
        <div class="sidebar-button">
            <i class='bx bx-menu sidebarBtn'></i>
            <span class="dashboard">Search Places </span>
        </div>

        <div class="profile-details">
            <span class="admin_name">{{user.username}}</span>
        </div>
        </nav>

        <div class="home-content">

            <div class="sales-boxes">
                <div class="recent-sales box">
                    <div class="title">Merchants </div>
                    <br>
                    <div>
                    Merchant: <select class="select" name="merchant" id="merchant">
                        <option value="" selected="selected">Select Merchant</option>
                    </select>
                    Area: <select class="select" name="area" id="area">
                        <option value="" selected="selected">Select Area</option>
                    </select>
                    <br><br>
                    <label for="percentage">Infected Percentage: </label>
                    <input type="text" id="percentage" value="">
                    <button type="button" id = "submit1">Search</button>

                    </div>
                </div>
            </div>

            <div class="sales-boxes">
                <div class="recent-sales box">
                    <div class="title">Top Infected Merchants</div>
                    <br>
                    <div class="sales-details">
                        <table id= "tracetable" >
                        <tr>
                            <th>Name</th> 
                            <th>Location</th>
                            <th>Infect Percentage(%)</th>
                        </tr>
                        {% for results in TopInfected%}
                        <tr>
                            <td>{{results.0}}</td>
                            <td>{{results.1}}</td>
                            <td>{{results.2}}</td>

                        </tr>
                        {% endfor %}

                        </table>

                    </div>
                    
                </div>
            </div>

        </div>
        <!--End of table-->

    </section>

    <script src="{% static 'js/main.js' %}"></script>



    <script>
    var subjectObject = {
        "Thilakawardana Textiles(Pvt) Ltd": ["Kiribathgoda"],
        "ODEL": ["Kiribathgoda","Colombo"],
        "McDonald's Kiribathgoda": ["Kiribathgoda", "Battaramulla"],
        "People's Bank": ["Kiribathgoda"],
        "Aruna Cinema": ["Kiribathgoda"],
        "Sampath Bank": ["Piliyandala"],
        "KCC": ["Kandy"],
        "Post Office": ["Battaramulla","Peliyagoda"],
        "University of Kelaniya": ["Kelaniya"],
        "Sathsara Shopping Center": ["Piliyandala"],
        "Pilimathalawa Tea Factory":["Pilimathalawa"]
    };

    window.onload = function() {
    var topicSel = document.getElementById("merchant");
    var chapterSel = document.getElementById("area");
    for (var x in subjectObject) {
        topicSel.options[topicSel.options.length] = new Option(x, x);
    }
    topicSel.onchange = function() {
        //empty Chapters dropdown
        chapterSel.length = 1;
        //display correct values
        var z = subjectObject[this.value];
        for (var i = 0; i < z.length; i++) {
        chapterSel.options[chapterSel.options.length] = new Option(z[i], z[i]);
        }
    }
    }

    </script>
    <script>
        const loadBtn = document.getElementById('submit1');

        function searchInfectPercentage() {
            var merchant = $('#merchant :selected').text();
            var area = $('#area :selected').text();
            $.ajax({
                url: '{% url "load" %}',
                type: 'GET',
                data: {
                    'merchant': merchant,
                    'area': area
                },
                beforeSend: function () {
                },
                success: function (response) {
                    const data = response.posts;
                    document.getElementById("percentage").value = Math.trunc(data[0][1]) +'%';
                    //console.log(response.posts[0][1]);

                },
                error: function (err) {
                    console.log(err);
                },
            });
        }
        loadBtn.addEventListener('click', () => {
            searchInfectPercentage()
        });
    </script>


</body>

</html>
